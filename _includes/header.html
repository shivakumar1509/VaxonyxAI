<header class="site-header" role="banner">
  <div class="container header-row">
    <a class="brand" href="{{ '/' | relative_url }}" aria-label="Vaxonyx home">
      <!-- Header logo should NOT be lazy -->
      <img class="brand-logo"
           src="{{ '/assets/Vaxonyx.svg' | relative_url }}"
           alt="Vaxonyx logo"
           width="160" height="42" decoding="async" fetchpriority="high">
    </a>

    <button class="menu-toggle" aria-controls="primary-nav" aria-expanded="false">☰</button>

    <nav id="primary-nav" class="site-nav" aria-label="Main">
      <ul class="menu" role="list">
        <li><a href="{{ '/' | relative_url }}">Home</a></li>

        <li class="dropdown">
          <a href="{{ '/about/' | relative_url }}" class="dropdown-link" aria-haspopup="true" aria-expanded="false">About ▾</a>
          <ul class="dropdown-menu" role="menu">
            <li><a role="menuitem" href="{{ '/about/#mission' | relative_url }}">Mission &amp; Vision</a></li>
            <li><a role="menuitem" href="{{ '/about/#team' | relative_url }}">Team</a></li>
            <li><a role="menuitem" href="{{ '/careers/' | relative_url }}">Careers</a></li>
          </ul>
        </li>

        <li class="dropdown">
          <a href="{{ '/services/' | relative_url }}" class="dropdown-link" aria-haspopup="true" aria-expanded="false">Services ▾</a>
          <ul class="dropdown-menu" role="menu" aria-label="Services submenu">
            <li><a role="menuitem" href="{{ '/services/cell-lines/' | relative_url }}">Cell line services</a></li>

            <li class="has-sub">
              <a href="{{ '/services/protein-production/' | relative_url }}" class="submenu-link" aria-haspopup="true" aria-expanded="false">
                Protein production ▸
              </a>
              <ul class="submenu" role="menu" aria-label="Protein production submenu">
                <li><a role="menuitem" href="{{ '/services/protein-production/antibody-production/' | relative_url }}">Antibody production</a></li>
                <li><a role="menuitem" href="{{ '/services/protein-production/antigen/' | relative_url }}">Antigen production</a></li>
              </ul>
            </li>

            <li class="has-sub">
              <a href="{{ '/services/assays/' | relative_url }}" class="submenu-link" aria-haspopup="true" aria-expanded="false">
                Assays ▸
              </a>
              <ul class="submenu" role="menu" aria-label="Assays submenu">
                <li><a role="menuitem" href="{{ '/services/assays/biochemical/' | relative_url }}">Biochemical assays</a></li>
                <li><a role="menuitem" href="{{ '/services/assays/virology/' | relative_url }}">Virology-Based assays</a></li>
              </ul>
            </li>

            <li><a href="{{ '/services/molecular-biology/' | relative_url }}">Molecular biology</a></li>
          </ul>
        </li>

        <li><a href="{{ '/innovation/' | relative_url }}">Innovation</a></li>
        <li><a href="{{ '/partners/' | relative_url }}">Partners</a></li>

        <li class="dropdown">
          <a href="{{ '/news/' | relative_url }}" class="dropdown-link" aria-haspopup="true" aria-expanded="false">News &amp; Investors ▾</a>
          <ul class="dropdown-menu" role="menu">
            <li><a role="menuitem" href="{{ '/news/#press' | relative_url }}">Press &amp; updates</a></li>
            <li><a role="menuitem" href="{{ '/investors/' | relative_url }}">Investor materials</a></li>
          </ul>
        </li>

        <li><a href="{{ '/contact/' | relative_url }}">Contact</a></li>

        <!-- Mobile-only AI button -->
        <li class="ai-inline">
          <button class="vx-fab" type="button" onclick="window.VX_WIDGET && VX_WIDGET.open()">Ask Vaxonyx AI</button>
        </li>
      </ul>
    </nav>

    <!-- Desktop AI button -->
    <button class="vx-fab vx-fab-desktop" type="button" onclick="window.VX_WIDGET && VX_WIDGET.open()">Ask Vaxonyx AI</button>
  </div>
</header>

<script>
  // Minimal a11y: keep aria-expanded in sync
  (function () {
    const toggle = document.querySelector('.menu-toggle');
    const nav = document.getElementById('primary-nav');
    if (!toggle || !nav) return;

    toggle.addEventListener('click', () => {
      const open = document.body.classList.toggle('nav-open');
      toggle.setAttribute('aria-expanded', open ? 'true' : 'false');
    });

    document.addEventListener('click', (e) => {
      if (!document.body.classList.contains('nav-open')) return;
      if (!e.target.closest('.site-header')) {
        document.body.classList.remove('nav-open');
        toggle.setAttribute('aria-expanded', 'false');
      }
    });

    // Close on ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && document.body.classList.contains('nav-open')) {
        document.body.classList.remove('nav-open');
        toggle.setAttribute('aria-expanded', 'false');
      }
    });
  })();
</script>
